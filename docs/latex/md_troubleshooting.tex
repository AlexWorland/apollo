\chapter{Troubleshooting }
\hypertarget{md_troubleshooting}{}\label{md_troubleshooting}\index{Troubleshooting@{Troubleshooting}}
\label{md_troubleshooting_autotoc_md250}%
\Hypertarget{md_troubleshooting_autotoc_md250}%
\hypertarget{md_troubleshooting_autotoc_md251}{}\doxysection{\texorpdfstring{General}{General}}\label{md_troubleshooting_autotoc_md251}
\hypertarget{md_troubleshooting_autotoc_md252}{}\doxysubsection{\texorpdfstring{Forgotten Credentials}{Forgotten Credentials}}\label{md_troubleshooting_autotoc_md252}
If you forgot your credentials to the web UI, try this.

@tabs\{ @tab\{General \texorpdfstring{$\vert$}{|} {\ttfamily bash sunshine -\/-\/creds \{new-\/username\} \{new-\/password\} } \} @tab\{App\+Image \texorpdfstring{$\vert$}{|} {\ttfamily bash ./sunshine.App\+Image -\/-\/creds \{new-\/username\} \{new-\/password\} } \} @tab\{Flatpak \texorpdfstring{$\vert$}{|} {\ttfamily bash flatpak run -\/-\/command=sunshine dev.\+lizardbyte.\+app.\+Sunshine -\/-\/creds \{new-\/username\} \{new-\/password\} } \} \}

\begin{DoxyRemark}{Remarks}
Remember to replace {\ttfamily \{new-\/username\}} and {\ttfamily \{new-\/password\}} with your new credentials. Do not include the curly braces.
\end{DoxyRemark}
\hypertarget{md_troubleshooting_autotoc_md253}{}\doxysubsection{\texorpdfstring{Unusual Mouse Behavior}{Unusual Mouse Behavior}}\label{md_troubleshooting_autotoc_md253}
If you experience unusual mouse behavior, try attaching a physical mouse to the Sunshine host.\hypertarget{md_troubleshooting_autotoc_md254}{}\doxysubsection{\texorpdfstring{Web UI Access}{Web UI Access}}\label{md_troubleshooting_autotoc_md254}
Can\textquotesingle{}t access the web UI?


\begin{DoxyEnumerate}
\item Check firewall rules.
\end{DoxyEnumerate}\hypertarget{md_troubleshooting_autotoc_md255}{}\doxysubsection{\texorpdfstring{Controller works on Steam but not in games}{Controller works on Steam but not in games}}\label{md_troubleshooting_autotoc_md255}
One trick might be to change Steam settings and check or uncheck the configuration to support Xbox/\+Play\+Station controllers and leave only support for Generic controllers.

Also, if you have many controllers already directly connected to the host, it might help to disable them so that the Sunshine-\/provided controller (connected to the guest) is the "{}first"{} one. In Linux this can be achieved on USB devices by finding the device in {\ttfamily /sys/bus/usb/devices/} and writing {\ttfamily 0} to the {\ttfamily authorized} file.\hypertarget{md_troubleshooting_autotoc_md256}{}\doxysubsection{\texorpdfstring{Network performance test}{Network performance test}}\label{md_troubleshooting_autotoc_md256}
For real-\/time game streaming the most important characteristic of the network path between server and client is not pure bandwidth but rather stability and consistency (low latency with low variance, minimal or no packet loss).

The network can be tested using the multi-\/platform tool \href{https://iperf.fr}{\texttt{i\+Perf3}}.

On the Sunshine host {\ttfamily iperf3} is started in server mode\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{iperf3\ -\/s}

\end{DoxyCode}


On the client device iperf3 is asked to perform a 60-\/second UDP test in a reverse direction (from server to client) at a given bitrate (e.\+g. 50 Mbps)\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{iperf3\ -\/c\ \{HostIpAddress\}\ -\/t\ 60\ -\/u\ -\/R\ -\/b\ 50M}

\end{DoxyCode}


Watch the output on the client for packet loss and jitter values. Both should be (very) low. Ideally, packet loss remains less than 5\% and jitter below 1 ms.

For Android clients use \href{https://play.google.com/store/apps/details?id=com.appplanex.pingmasternetworktools}{\texttt{Ping\+Master}}.

For i\+OS clients use \href{https://apps.apple.com/us/app/he-net-network-tools/id858241710}{\texttt{HE.\+NET Network Tools}}.

If you are testing a remote connection (over the internet), you will need to forward the port 5201 (TCP and UDP) from your host.\hypertarget{md_troubleshooting_autotoc_md257}{}\doxysubsection{\texorpdfstring{Packet loss (Buffer overrun)}{Packet loss (Buffer overrun)}}\label{md_troubleshooting_autotoc_md257}
If the host PC (running Sunshine) has a much faster connection to the network than the slowest segment of the network path to the client device (running Moonlight), massive packet loss can occur\+: Sunshine emits its stream in bursts every 16 ms (for 60 fps), but those bursts can\textquotesingle{}t be passed on fast enough to the client and must be buffered by one of the network devices inbetween. If the bitrate is high enough, these buffers will overflow and data will be discarded.

This can easily happen if e.\+g., the host has a 2.\+5 Gbit/s connection and the client only 1 Gbit/s or Wi-\/\+Fi. Similarly, a 1 Gbps host may be too fast for a client having only a 100 Mbps interface.

As a workaround the transmission speed of the host NIC can be reduced\+: 1 Gbps instead of 2.\+5 or 100 Mbps instead of 1 Gbps. A technically more advanced solution would be to configure traffic shaping rules at the OS level, so that only Sunshine\textquotesingle{}s traffic is slowed down.

Such a solution on Linux could look like that\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\#\ 1)\ Remove\ existing\ qdisc\ (pfifo\_fast)}
\DoxyCodeLine{sudo\ tc\ qdisc\ del\ dev\ <NIC>\ root}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ 2)\ Add\ HTB\ root\ qdisc\ with\ default\ class\ 1:1}
\DoxyCodeLine{sudo\ tc\ qdisc\ add\ dev\ <NIC>\ root\ handle\ 1:\ htb\ default\ 1}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ 3)\ Create\ class\ 1:1\ for\ full\ 10\ Gbit/s\ (all\ other\ traffic)}
\DoxyCodeLine{sudo\ tc\ class\ add\ dev\ <NIC>\ parent\ 1:\ classid\ 1:1\ htb\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ rate\ 10000mbit\ ceil\ 10000mbit\ burst\ 32k}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ 4)\ Create\ class\ 1:10\ for\ Sunshine\ game\ stream\ at\ 1\ Gbit/s}
\DoxyCodeLine{sudo\ tc\ class\ add\ dev\ <NIC>\ parent\ 1:\ classid\ 1:10\ htb\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ rate\ 1000mbit\ ceil\ 1000mbit\ burst\ 32k}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ 5)\ Filter\ UDP\ source\ port\ 47998\ into\ class\ 1:10}
\DoxyCodeLine{sudo\ tc\ filter\ add\ dev\ <NIC>\ protocol\ ip\ parent\ 1:\ prio\ 1\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ u32\ match\ ip\ protocol\ 17\ 0xff\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ match\ ip\ sport\ 47998\ 0xffff\ flowid\ 1:10}

\end{DoxyCode}


In that way only the Sunshine traffic is limited by 1 Gbit. This is not persistent on reboots. If you use a different port for the game stream, you need to adjust the last command.

Sunshine versions \texorpdfstring{$>$}{>} 0.\+23.\+1 include improved networking code that should alleviate or even solve this issue (without reducing the NIC speed).\hypertarget{md_troubleshooting_autotoc_md258}{}\doxysubsection{\texorpdfstring{Packet loss (MTU)}{Packet loss (MTU)}}\label{md_troubleshooting_autotoc_md258}
Although unlikely, some guests might work better with a lower \href{https://en.wikipedia.org/wiki/Maximum_transmission_unit}{\texttt{MTU}} from the host. For example, an LG TV was found to have 30â€“60\% packet loss when the host had MTU set to 1500 and 1472, but 0\% packet loss with a MTU of 1428 set in the network card serving the stream (a Linux PC). It\textquotesingle{}s unclear how that helped precisely, so it\textquotesingle{}s a last resort suggestion.\hypertarget{md_troubleshooting_autotoc_md259}{}\doxysection{\texorpdfstring{Linux}{Linux}}\label{md_troubleshooting_autotoc_md259}
\hypertarget{md_troubleshooting_autotoc_md260}{}\doxysubsection{\texorpdfstring{Hardware Encoding fails}{Hardware Encoding fails}}\label{md_troubleshooting_autotoc_md260}
Due to legal concerns, Mesa has disabled hardware decoding and encoding by default.


\begin{DoxyCode}{0}
\DoxyCodeLine{Error:\ Could\ not\ open\ codec\ [h264\_vaapi]:\ Function\ not\ implemented}

\end{DoxyCode}


If you see the above error in the Sunshine logs, compiling {\itshape Mesa} manually may be required. See the official Mesa3D \href{https://docs.mesa3d.org/install.html}{\texttt{Compiling and Installing}} documentation for instructions.

\begin{DoxyImportant}{Important}
You must re-\/enable the disabled encoders. You can do so by passing the following argument to the build system. You may also want to enable decoders, however, that is not required for Sunshine and is not covered here. 
\begin{DoxyCode}{0}
\DoxyCodeLine{-\/Dvideo-\/codecs=h264enc,h265enc}

\end{DoxyCode}

\end{DoxyImportant}
\begin{DoxyNote}{Note}
Other build options are listed in the \href{https://gitlab.freedesktop.org/mesa/mesa/-/blob/main/meson_options.txt}{\texttt{meson options}} file.
\end{DoxyNote}
\hypertarget{md_troubleshooting_autotoc_md261}{}\doxysubsection{\texorpdfstring{Input not working}{Input not working}}\label{md_troubleshooting_autotoc_md261}
After installation, the {\ttfamily udev} rules need to be reloaded. Our post-\/install script tries to do this for you automatically, but if it fails, you may need to restart your system.

If the input is still not working, you may need to add your user to the {\ttfamily input} group.


\begin{DoxyCode}{0}
\DoxyCodeLine{sudo\ usermod\ -\/aG\ input\ \$USER}

\end{DoxyCode}
\hypertarget{md_troubleshooting_autotoc_md262}{}\doxysubsection{\texorpdfstring{KMS Streaming fails}{KMS Streaming fails}}\label{md_troubleshooting_autotoc_md262}
If screencasting fails with KMS, you may need to run the following to force unprivileged screencasting.


\begin{DoxyCode}{0}
\DoxyCodeLine{sudo\ setcap\ -\/r\ \$(readlink\ -\/f\ \$(which\ sunshine))}

\end{DoxyCode}


\begin{DoxyNote}{Note}
The above command will not work with the App\+Image or Flatpak packages. Please refer to the \href{md_docs_2getting__started.html\#appimage}{\texttt{App\+Image setup}} or \href{md_docs_2getting__started.html\#flatpak}{\texttt{Flatpak setup}} for more specific instructions.
\end{DoxyNote}
\hypertarget{md_troubleshooting_autotoc_md263}{}\doxysubsection{\texorpdfstring{KMS streaming fails on Nvidia GPUs}{KMS streaming fails on Nvidia GPUs}}\label{md_troubleshooting_autotoc_md263}
If KMS screen capture results in a black screen being streamed, you may need to set the parameter {\ttfamily modeset=1} for Nvidia\textquotesingle{}s kernel module. This can be done by adding the following directive to the kernel command line\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{nvidia\_drm.modeset=1}

\end{DoxyCode}


Consult your distribution\textquotesingle{}s documentation for details on how to do this. (Most often grub is used to load the kernel and set its command line.)\hypertarget{md_troubleshooting_autotoc_md264}{}\doxysubsection{\texorpdfstring{AMD encoding latency issues}{AMD encoding latency issues}}\label{md_troubleshooting_autotoc_md264}
If you notice unexpectedly high encoding latencies (e.\+g., in Moonlight\textquotesingle{}s performance overlay) or strong fluctuations thereof, your system\textquotesingle{}s Mesa libraries are outdated (\texorpdfstring{$<$}{<}24.\+2). This is particularly problematic at higher resolutions (4K).

Starting with Mesa-\/24.\+2, applications can request a \href{https://gitlab.freedesktop.org/mesa/mesa/-/merge_requests/30039}{\texttt{low-\/latency mode}} by running them with a special \href{https://docs.mesa3d.org/envvars.html\#envvar-AMD_DEBUG}{\texttt{environment variable}}\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{export\ AMD\_DEBUG=lowlatencyenc}

\end{DoxyCode}
 Sunshine sets this variable automatically, no manual configuration is needed.

To check whether low-\/latency mode is being used, one can watch the VCLK and DCLK frequencies in amdgpu\+\_\+top. Without this encoder tuning both clock frequencies will fluctuate strongly, whereas with active low-\/latency encoding they will stay high as long as the encoder is used.\hypertarget{md_troubleshooting_autotoc_md265}{}\doxysubsection{\texorpdfstring{Gamescope compatibility}{Gamescope compatibility}}\label{md_troubleshooting_autotoc_md265}
Some users have reported stuttering issues when streaming games running within Gamescope.\hypertarget{md_troubleshooting_autotoc_md266}{}\doxysection{\texorpdfstring{mac\+OS}{mac\+OS}}\label{md_troubleshooting_autotoc_md266}
\hypertarget{md_troubleshooting_autotoc_md267}{}\doxysubsection{\texorpdfstring{Dynamic session lookup failed}{Dynamic session lookup failed}}\label{md_troubleshooting_autotoc_md267}
If you get this error\+:

\begin{quote}
Dynamic session lookup supported but failed\+: launchd did not provide a socket path, verify that org.\+freedesktop.\+dbus-\/session.\+plist is loaded! \end{quote}


Try this. 
\begin{DoxyCode}{0}
\DoxyCodeLine{launchctl\ load\ -\/w\ /Library/LaunchAgents/org.freedesktop.dbus-\/session.plist}

\end{DoxyCode}
\hypertarget{md_troubleshooting_autotoc_md268}{}\doxysection{\texorpdfstring{Windows}{Windows}}\label{md_troubleshooting_autotoc_md268}
\hypertarget{md_troubleshooting_autotoc_md269}{}\doxysubsection{\texorpdfstring{No gamepad detected}{No gamepad detected}}\label{md_troubleshooting_autotoc_md269}
Verify that you\textquotesingle{}ve installed \href{https://github.com/nefarius/ViGEmBus/releases/latest}{\texttt{Nefarius Virtual Gamepad}}.\hypertarget{md_troubleshooting_autotoc_md270}{}\doxysubsection{\texorpdfstring{Permission denied}{Permission denied}}\label{md_troubleshooting_autotoc_md270}
Since Sunshine runs as a service on Windows, it may not have the same level of access that your regular user account has. You may get permission denied errors when attempting to launch a game or application from a non-\/system drive.

You will need to modify the security permissions on your disk. Ensure that user/principal SYSTEM has full permissions on the disk.\hypertarget{md_troubleshooting_autotoc_md271}{}\doxysubsection{\texorpdfstring{Stuttering}{Stuttering}}\label{md_troubleshooting_autotoc_md271}
If you experience stuttering using NVIDIA, try disabling {\ttfamily vsync\+:fast} in the NVIDIA Control Panel.




\begin{DoxyTable}{2}{}{}{1}
\SetCell{bg=\tableheadbgcolor,font=\bfseries}Previous  &\SetCell{r,bg=\tableheadbgcolor,font=\bfseries}Next  \\
\doxysectlink{md_api}{API}{0}  &\SetCell{r}\doxysectlink{md_building}{Building}{0}  \\
\end{DoxyTable}






{\bfseries{}}\begin{adjustwidth}{1em}{0em}


\end{adjustwidth}
